[{"data":1,"prerenderedAt":469},["ShallowReactive",2],{"post-/topics/scraping":3},[4],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":6,"title":8,"description":9,"draft":7,"ignore":7,"topics":10,"date":14,"created_at":14,"last_modified":15,"body":16,"_type":463,"_id":464,"_source":465,"_file":466,"_stem":467,"_extension":468},"/scraping-business-data-from-google-maps-using-ai-and-agentql","",false,"Scraping business data from Google Maps using AI and AgentQL","Writing web scraping scripts by hand typically follows a development pattern like:",[11,12,13],"ai","scraping","agentql","2024-12-05T16:04","2024-12-08T12:49",{"type":17,"children":18,"toc":449},"root",[19,26,46,51,58,72,86,96,101,110,115,121,126,134,139,147,152,173,178,185,205,210,246,252,257,262,268,273,284,290,319,332,338,343,351,364,372,377,385,398,411,416,424,430,439,444],{"type":20,"tag":21,"props":22,"children":23},"element","p",{},[24],{"type":25,"value":9},"text",{"type":20,"tag":27,"props":28,"children":29},"ol",{},[30,36,41],{"type":20,"tag":31,"props":32,"children":33},"li",{},[34],{"type":25,"value":35},"Find the xpath/locator for a piece of data I'm interested in",{"type":20,"tag":31,"props":37,"children":38},{},[39],{"type":25,"value":40},"Select the data needed",{"type":20,"tag":31,"props":42,"children":43},{},[44],{"type":25,"value":45},"Make it resilient if the element/data isn't there",{"type":20,"tag":21,"props":47,"children":48},{},[49],{"type":25,"value":50},"This can be an exhausting process, taking tons of time clicking through the rendered web page to find the code you want to use as your locator.",{"type":20,"tag":52,"props":53,"children":55},"h2",{"id":54},"using-ai-to-solve-this",[56],{"type":25,"value":57},"Using AI to solve this",{"type":20,"tag":21,"props":59,"children":60},{},[61,70],{"type":20,"tag":62,"props":63,"children":67},"a",{"href":64,"rel":65},"https://agentql.com/",[66],"nofollow",[68],{"type":25,"value":69},"AgentQL",{"type":25,"value":71}," provide what they call \"an AI-native query language\" to make the developer experience of web scraping much easier to do.",{"type":20,"tag":21,"props":73,"children":74},{},[75,77,84],{"type":25,"value":76},"Rather than having to write complex DOM selection code, you can instead query the rendered pages using a custom query language that AgentQL provicdes. Here is an example query that I use to target ",{"type":20,"tag":62,"props":78,"children":81},{"href":79,"rel":80},"https://google.com",[66],[82],{"type":25,"value":83},"Google's",{"type":25,"value":85}," search input and Google Search button:",{"type":20,"tag":87,"props":88,"children":90},"pre",{"code":89},"{\n    search_box\n    submit_btn\n}\n",[91],{"type":20,"tag":92,"props":93,"children":94},"code",{"__ignoreMap":6},[95],{"type":25,"value":89},{"type":20,"tag":21,"props":97,"children":98},{},[99],{"type":25,"value":100},"This query returns these two elements:",{"type":20,"tag":21,"props":102,"children":103},{},[104],{"type":20,"tag":105,"props":106,"children":109},"img",{"alt":107,"src":108},"highlighted Google landing page showcasing what elements the agentql query locates","https://i.imgur.com/gtDt10y.png",[],{"type":20,"tag":21,"props":111,"children":112},{},[113],{"type":25,"value":114},"And now I have the ability to type into the search box and click the submit button.",{"type":20,"tag":52,"props":116,"children":118},{"id":117},"comparing-agentql-to-traditional-playwright",[119],{"type":25,"value":120},"Comparing AgentQL to traditional Playwright",{"type":20,"tag":21,"props":122,"children":123},{},[124],{"type":25,"value":125},"Written out in Javascript using Playwright, this looks like:",{"type":20,"tag":87,"props":127,"children":129},{"code":128},"// playwright_example.js\nconst inputQuery = \"'plumbing' inurl:business.site santa rosa\"\nconst searchBox = await page.$('xpath=//*[@id=\"APjFqb\"]')\n\nif (searchBox) {\n    await searchBox.fill(inputQuery)\n    await searchBox.press('Enter')\n} else {\n    console.error('Search box not found.')\n}\n",[130],{"type":20,"tag":92,"props":131,"children":132},{"__ignoreMap":6},[133],{"type":25,"value":128},{"type":20,"tag":21,"props":135,"children":136},{},[137],{"type":25,"value":138},"Using AgentQL, it looks like:",{"type":20,"tag":87,"props":140,"children":142},{"code":141},"// agentql_example.js\nconst inputQuery = \"'plumbing' inurl:business.site santa rosa\"\nconst formQuery = `{\n    search_box\n    submit_btn\n}`\n\nconst response = await page.queryElements(formQuery)\nawait response.search_box.type(inputQuery)\nawait response.submit_btn.click()\n",[143],{"type":20,"tag":92,"props":144,"children":145},{"__ignoreMap":6},[146],{"type":25,"value":141},{"type":20,"tag":21,"props":148,"children":149},{},[150],{"type":25,"value":151},"I find the AgentQL example to be more explicit. Querying the page using natural language makes understanding what the code is doing easier.",{"type":20,"tag":21,"props":153,"children":154},{},[155,157,163,165,171],{"type":25,"value":156},"Querying the xpath ",{"type":20,"tag":92,"props":158,"children":160},{"className":159},[],[161],{"type":25,"value":162},"'xpath=//*[@id=\"APjFqb\"]'",{"type":25,"value":164}," in Playwright provides zero information for me in this example. It's worth mentioning, the id ",{"type":20,"tag":92,"props":166,"children":168},{"className":167},[],[169],{"type":25,"value":170},"APjFqb",{"type":25,"value":172}," is likely auto-generated and will change in the future, making this script fragile.",{"type":20,"tag":21,"props":174,"children":175},{},[176],{"type":25,"value":177},"This is a basic example that only accesses a single element, but later on we will need to iterate over many businesses, gathering multiple pieces of data from each business.",{"type":20,"tag":179,"props":180,"children":182},"h3",{"id":181},"inputquery",[183],{"type":25,"value":184},"inputQuery",{"type":20,"tag":21,"props":186,"children":187},{},[188,190,195,197,203],{"type":25,"value":189},"The ",{"type":20,"tag":92,"props":191,"children":193},{"className":192},[],[194],{"type":25,"value":184},{"type":25,"value":196}," value of ",{"type":20,"tag":92,"props":198,"children":200},{"className":199},[],[201],{"type":25,"value":202},"\"'plumbing' inurl:business.site santa rosa\"",{"type":25,"value":204}," is using an alternative Google search syntax to find the businesses I'm interested in processing.",{"type":20,"tag":21,"props":206,"children":207},{},[208],{"type":25,"value":209},"Here’s a breakdown of the components of the query:",{"type":20,"tag":27,"props":211,"children":212},{},[213,224,235],{"type":20,"tag":31,"props":214,"children":215},{},[216,222],{"type":20,"tag":92,"props":217,"children":219},{"className":218},[],[220],{"type":25,"value":221},"plumbing",{"type":25,"value":223},": This part specifies that the search results should include the term “plumbing”. It’s a keyword that indicates the type of service or business you are interested in.",{"type":20,"tag":31,"props":225,"children":226},{},[227,233],{"type":20,"tag":92,"props":228,"children":230},{"className":229},[],[231],{"type":25,"value":232},"inurl:business.site",{"type":25,"value":234},": The ⁠inurl: operator tells Google to look for web pages that contain “business.site” in their URL. This is typically associated with Google My Business websites or pages created on Google’s business site platform, which allows small businesses to create a free website. Therefore, this portion of the query is targeting business webpages that are likely to represent local businesses, possibly small plumbing companies.",{"type":20,"tag":31,"props":236,"children":237},{},[238,244],{"type":20,"tag":92,"props":239,"children":241},{"className":240},[],[242],{"type":25,"value":243},"santa rosa",{"type":25,"value":245},": This part of the query specifies a geographic location, in this case, Santa Rosa. Google will prioritize results that are relevant to this location.",{"type":20,"tag":52,"props":247,"children":249},{"id":248},"gathering-business-data",[250],{"type":25,"value":251},"Gathering business data",{"type":20,"tag":21,"props":253,"children":254},{},[255],{"type":25,"value":256},"Let's scrap the example from earlier, and now explore Google Maps.",{"type":20,"tag":21,"props":258,"children":259},{},[260],{"type":25,"value":261},"The problem we're solving is gathering business data within specific locations. I'm not sure of a better source for this than Google Maps. Let me know if you know of a better option!",{"type":20,"tag":179,"props":263,"children":265},{"id":264},"installation",[266],{"type":25,"value":267},"Installation",{"type":20,"tag":21,"props":269,"children":270},{},[271],{"type":25,"value":272},"First, install the AgentQL library:",{"type":20,"tag":87,"props":274,"children":279},{"code":275,"language":276,"meta":6,"className":277},"npm install agentql\n","bash",[278],"language-bash",[280],{"type":20,"tag":92,"props":281,"children":282},{"__ignoreMap":6},[283],{"type":25,"value":275},{"type":20,"tag":179,"props":285,"children":287},{"id":286},"api-key",[288],{"type":25,"value":289},"API Key",{"type":20,"tag":21,"props":291,"children":292},{},[293,295,301,303,309,311,317],{"type":25,"value":294},"You'll also need an API key. Navigate to ",{"type":20,"tag":62,"props":296,"children":299},{"href":297,"rel":298},"https://dev.agentql.com/api-keys",[66],[300],{"type":25,"value":297},{"type":25,"value":302}," and create one. In the code examples I show, you'll see ",{"type":20,"tag":92,"props":304,"children":306},{"className":305},[],[307],{"type":25,"value":308},"configure({ apiKey: '' })",{"type":25,"value":310},". Assume the ",{"type":20,"tag":92,"props":312,"children":314},{"className":313},[],[315],{"type":25,"value":316},"''",{"type":25,"value":318}," is actually the api key AgentQL provided.",{"type":20,"tag":21,"props":320,"children":321},{},[322,324,330],{"type":25,"value":323},"I recommend utilizing a ",{"type":20,"tag":92,"props":325,"children":327},{"className":326},[],[328],{"type":25,"value":329},".env",{"type":25,"value":331}," file but for the simplicity of this project, we'll avoid any setup or further mention of proper environment variable management.",{"type":20,"tag":179,"props":333,"children":335},{"id":334},"script",[336],{"type":25,"value":337},"Script",{"type":20,"tag":21,"props":339,"children":340},{},[341],{"type":25,"value":342},"Start with this basic script:",{"type":20,"tag":87,"props":344,"children":346},{"code":345},"// main.js\nconst { wrap, configure } = require('agentql')\nconst { chromium } = require('playwright')\n\nconst queryMap = async () => {\n    // Configure the AgentQL API key\n    configure({ apiKey: '' })\n\n    // Launch a headless browser using Playwright.\n    const browser = await chromium.launch({ headless: false })\n\n    // Create a new page in the browser and wrap it to get access to the AgentQL's querying API\n    const page = await wrap(await browser.newPage())\n    await page.goto('https://www.google.com/maps')\n}\n",[347],{"type":20,"tag":92,"props":348,"children":349},{"__ignoreMap":6},[350],{"type":25,"value":345},{"type":20,"tag":21,"props":352,"children":353},{},[354,356,362],{"type":25,"value":355},"Bring in what we discussed earlier, using AgentQL to query for the search box using the ",{"type":20,"tag":92,"props":357,"children":359},{"className":358},[],[360],{"type":25,"value":361},".queryElements()",{"type":25,"value":363}," function:",{"type":20,"tag":87,"props":365,"children":367},{"code":366},"// main.js\nconst elements = await page.queryElements(`{ search_box }`)\nawait elements.search_box.type(\"'plumbing' inurl:business.site santa rosa\")\nawait elements.search_box.press('Enter')\n",[368],{"type":20,"tag":92,"props":369,"children":370},{"__ignoreMap":6},[371],{"type":25,"value":366},{"type":20,"tag":21,"props":373,"children":374},{},[375],{"type":25,"value":376},"This will search Google Maps, showing all of the businesses listed on Google Maps that are classified as plumbing and in the Santa Rosa area.",{"type":20,"tag":87,"props":378,"children":380},{"code":379},"// main.js\nconst data = await page.queryData(`{\n  business[] {\n    name\n    website_url\n    address\n    rating\n    review_count\n    service_type\n  }\n}`)\n\nconsole.log(data)\n",[381],{"type":20,"tag":92,"props":382,"children":383},{"__ignoreMap":6},[384],{"type":25,"value":379},{"type":20,"tag":21,"props":386,"children":387},{},[388,390,396],{"type":25,"value":389},"Now we can use the ",{"type":20,"tag":92,"props":391,"children":393},{"className":392},[],[394],{"type":25,"value":395},".queryData()",{"type":25,"value":397}," function to extract data to fit the structure we provide.",{"type":20,"tag":21,"props":399,"children":400},{},[401,403,409],{"type":25,"value":402},"In this query, I am defining a data structure ",{"type":20,"tag":92,"props":404,"children":406},{"className":405},[],[407],{"type":25,"value":408},"business[]",{"type":25,"value":410},". This forces AgentQL to return a business array that contains objects with the name, website_url, ..., service_type fields.",{"type":20,"tag":21,"props":412,"children":413},{},[414],{"type":25,"value":415},"Running the queryData code above, I received this response:",{"type":20,"tag":87,"props":417,"children":419},{"code":418},"{\n  business: [\n    {\n      name: 'United States Plumbing',\n      website_url: 'http://unitedstatesplumbing.net/',\n      address: '445 S E St #12',\n      rating: 4.9,\n      review_count: 57,\n      service_type: 'Plumber'\n    },\n    {\n      name: '707 Plumbers, Inc. & Electric',\n      website_url: 'https://707plumbersinc.com/?utm_source=google&utm_medium=organic&utm_campaign=gbp-listing',\n      address: '860 Piner Rd Suite 18',\n      rating: 5,\n      review_count: 93,\n      service_type: 'Plumber'\n    },\n    {\n      name: 'PACE Supply',\n      website_url: 'http://www.pacesupply.com/',\n      address: '3033 Dutton Ave',\n      rating: 4.6,\n      review_count: 91,\n      service_type: 'Plumbing supply store'\n    },\n    {\n      name: 'Curoso Plumbing Inc.',\n      website_url: 'http://curosoplumbing.com/?utm_campaign=gmb',\n      address: '1925 Fulton Rd',\n      rating: 5,\n      review_count: 151,\n      service_type: 'Plumber'\n    },\n    {\n      name: 'A Better Plumbing Company | Plumber Santa Rosa',\n      website_url: 'https://abetterplumbingcompany.com/',\n      address: '1410 Neotomas Ave',\n      rating: 5,\n      review_count: 14,\n      service_type: 'Plumber'\n    },\n    {\n      name: 'Maples Plumbing & Heating',\n      website_url: 'https://www.maplesservice.com/',\n      address: '280 Castro Ct',\n      rating: 4.9,\n      review_count: 101,\n      service_type: 'Plumber'\n    },\n    {\n      name: 'Custom Plumbing of Northern California, Inc.',\n      website_url: 'http://gocustomplumbing.com/',\n      address: '3100 Dutton Ave Suite 128',\n      rating: 4.2,\n      review_count: 5,\n      service_type: 'Plumber'\n    },\n    {\n      name: 'Super Service Plumbing',\n      website_url: 'https://superserviceplumbing.com/',\n      address: '2833 Dowd Dr A',\n      rating: 4.9,\n      review_count: 48,\n      service_type: 'Plumber'\n    }\n  ]\n}\n",[420],{"type":20,"tag":92,"props":421,"children":422},{"__ignoreMap":6},[423],{"type":25,"value":418},{"type":20,"tag":52,"props":425,"children":427},{"id":426},"conclusion",[428],{"type":25,"value":429},"Conclusion",{"type":20,"tag":431,"props":432,"children":433},"blockquote",{},[434],{"type":20,"tag":21,"props":435,"children":436},{},[437],{"type":25,"value":438},"And there we have it.",{"type":20,"tag":21,"props":440,"children":441},{},[442],{"type":25,"value":443},"I haven't found a fundamental shift in how the problem is being solved. You can still write the scraping logic by hand and have it be every bit as robust and probably more efficient. But these tools are allowing me to extract data using web scraping much quicker than before.",{"type":20,"tag":21,"props":445,"children":446},{},[447],{"type":25,"value":448},"With a bit of creative engineering, I can see patterns appear that allow for much broader queries that are flexible and applicable to a wide array of websites. I've enjoyed my initial dip into this tool and am excited to see where it goes.",{"title":6,"searchDepth":450,"depth":450,"links":451},2,[452,453,457,462],{"id":54,"depth":450,"text":57},{"id":117,"depth":450,"text":120,"children":454},[455],{"id":181,"depth":456,"text":184},3,{"id":248,"depth":450,"text":251,"children":458},[459,460,461],{"id":264,"depth":456,"text":267},{"id":286,"depth":456,"text":289},{"id":334,"depth":456,"text":337},{"id":426,"depth":450,"text":429},"markdown","content:scraping-business-data-from-google-maps-using-ai-and-agentql.md","content","scraping-business-data-from-google-maps-using-ai-and-agentql.md","scraping-business-data-from-google-maps-using-ai-and-agentql","md",1733866075048]