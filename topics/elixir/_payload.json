[{"data":1,"prerenderedAt":691},["ShallowReactive",2],{"post-/topics/elixir":3},[4],{"_path":5,"_dir":6,"_draft":7,"_partial":7,"_locale":6,"title":8,"description":9,"type":10,"author":11,"date":14,"last_modified_date":14,"slug":15,"dropdown":16,"meta":17,"canonicalUrl":31,"topics":32,"body":36,"_type":686,"_id":687,"_source":688,"_file":689,"_stem":15,"_extension":690},"/mocking-http-responses-in-elixir-and-phoenix","",false,"Mocking HTTP Responses in Elixir and Phoenix","A quick walkthrough of the configuration needed to support mocks and modules only used within your Elixir tests","post",{"name":12,"image":13},"Cody Bontecou","/assets/img/cody.64b57256.jpg","2023-08-13T00:00:00.000Z","mocking-http-responses-in-elixir-and-phoenix","Elixir",[18,20,23,25,27,29],{"name":19,"content":9},"og:description",{"name":21,"content":22},"og:image","https://codybontecou.com/images/mocking-http-responses-in-elixir-and-phoenix.png",{"name":24,"content":9},"og:image:alt",{"name":26,"content":8},"og:title",{"name":28,"content":8},"twitter:title",{"name":30,"content":8},"twitter:text:title","https://codybontecou.com/mocking-http-responses-in-elixir-and-phoenix.html",[33,34,35],"elixir","testing","mocking",{"type":37,"children":38,"toc":681},"root",[39,49,56,66,73,78,134,139,229,249,255,276,300,327,600,605,656,662,675],{"type":40,"tag":41,"props":42,"children":43},"element","h1",{"id":6},[44],{"type":40,"tag":45,"props":46,"children":48},"binding",{"value":47},"$frontmatter.title",[],{"type":40,"tag":50,"props":51,"children":52},"p",{},[53],{"type":54,"value":55},"text","I just came across this error while attempting to mock the response of a 3rd party api:",{"type":40,"tag":50,"props":57,"children":58},{},[59],{"type":40,"tag":60,"props":61,"children":63},"code",{"className":62},[],[64],{"type":54,"value":65},"** (UndefinedFunctionError) function LeagueInfoMocks.get_live/0 is undefined (module LeagueInfoMocks is not available)",{"type":40,"tag":67,"props":68,"children":70},"h2",{"id":69},"the-problem",[71],{"type":54,"value":72},"The Problem",{"type":40,"tag":50,"props":74,"children":75},{},[76],{"type":54,"value":77},"I couldn't wrap my head around it. I have this simple mock module defined:",{"type":40,"tag":79,"props":80,"children":83},"pre",{"className":81,"code":82,"language":33,"meta":6,"style":6},"language-elixir shiki shiki-themes github-light","defmodule LeagueInfoMocks do\n  def get_live do\n    %{...}\n  end\nend\n\n",[84],{"type":40,"tag":60,"props":85,"children":86},{"__ignoreMap":6},[87,98,107,116,125],{"type":40,"tag":88,"props":89,"children":92},"span",{"class":90,"line":91},"line",1,[93],{"type":40,"tag":88,"props":94,"children":95},{},[96],{"type":54,"value":97},"defmodule LeagueInfoMocks do\n",{"type":40,"tag":88,"props":99,"children":101},{"class":90,"line":100},2,[102],{"type":40,"tag":88,"props":103,"children":104},{},[105],{"type":54,"value":106},"  def get_live do\n",{"type":40,"tag":88,"props":108,"children":110},{"class":90,"line":109},3,[111],{"type":40,"tag":88,"props":112,"children":113},{},[114],{"type":54,"value":115},"    %{...}\n",{"type":40,"tag":88,"props":117,"children":119},{"class":90,"line":118},4,[120],{"type":40,"tag":88,"props":121,"children":122},{},[123],{"type":54,"value":124},"  end\n",{"type":40,"tag":88,"props":126,"children":128},{"class":90,"line":127},5,[129],{"type":40,"tag":88,"props":130,"children":131},{},[132],{"type":54,"value":133},"end\n",{"type":40,"tag":50,"props":135,"children":136},{},[137],{"type":54,"value":138},"And a test module to interact with the get_live function:",{"type":40,"tag":79,"props":140,"children":142},{"className":81,"code":141,"language":33,"meta":6,"style":6},"defmodule LeagueInfoTest do\n  use ExUnit.Case\n  test \"format_info\" do\n    data = LeagueInfoMocks.get_live()\n\n    [match | _tail] = data\n\n    assert LeagueInfo.format_info(data) == %{...}\n  end\nend\n\n",[143],{"type":40,"tag":60,"props":144,"children":145},{"__ignoreMap":6},[146,154,162,170,178,187,196,204,213,221],{"type":40,"tag":88,"props":147,"children":148},{"class":90,"line":91},[149],{"type":40,"tag":88,"props":150,"children":151},{},[152],{"type":54,"value":153},"defmodule LeagueInfoTest do\n",{"type":40,"tag":88,"props":155,"children":156},{"class":90,"line":100},[157],{"type":40,"tag":88,"props":158,"children":159},{},[160],{"type":54,"value":161},"  use ExUnit.Case\n",{"type":40,"tag":88,"props":163,"children":164},{"class":90,"line":109},[165],{"type":40,"tag":88,"props":166,"children":167},{},[168],{"type":54,"value":169},"  test \"format_info\" do\n",{"type":40,"tag":88,"props":171,"children":172},{"class":90,"line":118},[173],{"type":40,"tag":88,"props":174,"children":175},{},[176],{"type":54,"value":177},"    data = LeagueInfoMocks.get_live()\n",{"type":40,"tag":88,"props":179,"children":180},{"class":90,"line":127},[181],{"type":40,"tag":88,"props":182,"children":184},{"emptyLinePlaceholder":183},true,[185],{"type":54,"value":186},"\n",{"type":40,"tag":88,"props":188,"children":190},{"class":90,"line":189},6,[191],{"type":40,"tag":88,"props":192,"children":193},{},[194],{"type":54,"value":195},"    [match | _tail] = data\n",{"type":40,"tag":88,"props":197,"children":199},{"class":90,"line":198},7,[200],{"type":40,"tag":88,"props":201,"children":202},{"emptyLinePlaceholder":183},[203],{"type":54,"value":186},{"type":40,"tag":88,"props":205,"children":207},{"class":90,"line":206},8,[208],{"type":40,"tag":88,"props":209,"children":210},{},[211],{"type":54,"value":212},"    assert LeagueInfo.format_info(data) == %{...}\n",{"type":40,"tag":88,"props":214,"children":216},{"class":90,"line":215},9,[217],{"type":40,"tag":88,"props":218,"children":219},{},[220],{"type":54,"value":124},{"type":40,"tag":88,"props":222,"children":224},{"class":90,"line":223},10,[225],{"type":40,"tag":88,"props":226,"children":227},{},[228],{"type":54,"value":133},{"type":40,"tag":50,"props":230,"children":231},{},[232,234,240,242,247],{"type":54,"value":233},"But running ",{"type":40,"tag":60,"props":235,"children":237},{"className":236},[],[238],{"type":54,"value":239},"mix test",{"type":54,"value":241}," would consistently give me the ",{"type":40,"tag":60,"props":243,"children":245},{"className":244},[],[246],{"type":54,"value":65},{"type":54,"value":248},".",{"type":40,"tag":67,"props":250,"children":252},{"id":251},"the-solution",[253],{"type":54,"value":254},"The Solution",{"type":40,"tag":50,"props":256,"children":257},{},[258,260,266,268,274],{"type":54,"value":259},"Most articles and threads mentioned moving the ",{"type":40,"tag":60,"props":261,"children":263},{"className":262},[],[264],{"type":54,"value":265},"LeagueInfoMocks",{"type":54,"value":267}," module in the ",{"type":40,"tag":60,"props":269,"children":271},{"className":270},[],[272],{"type":54,"value":273},"test/support/*",{"type":54,"value":275}," directory, so I did. This didn't change the error message.",{"type":40,"tag":50,"props":277,"children":278},{},[279,281,290,292,298],{"type":54,"value":280},"I eventually found ",{"type":40,"tag":282,"props":283,"children":287},"a",{"href":284,"rel":285},"https://stackoverflow.com/a/73967553/6642089",[286],"nofollow",[288],{"type":54,"value":289},"this",{"type":54,"value":291}," Stackoverflow comment that mentioned some configuration needed in the ",{"type":40,"tag":60,"props":293,"children":295},{"className":294},[],[296],{"type":54,"value":297},"mix.exs",{"type":54,"value":299}," file.",{"type":40,"tag":50,"props":301,"children":302},{},[303,305,311,313,318,320,325],{"type":54,"value":304},"Supposedly, ",{"type":40,"tag":60,"props":306,"children":308},{"className":307},[],[309],{"type":54,"value":310},"mix phx.new",{"type":54,"value":312}," adds the ",{"type":40,"tag":60,"props":314,"children":316},{"className":315},[],[317],{"type":54,"value":273},{"type":54,"value":319}," support when a Phoenix project is created. In my case, I'm building off of a simple Elixir application. This required me to configure my ",{"type":40,"tag":60,"props":321,"children":323},{"className":322},[],[324],{"type":54,"value":297},{"type":54,"value":326}," file to look like so:",{"type":40,"tag":79,"props":328,"children":330},{"className":81,"code":329,"language":33,"meta":6,"style":6},"defmodule LolesportsConsumer.MixProject do\n  use Mix.Project\n\n  def project do\n    [\n      app: :lolesports_consumer,\n      version: \"0.1.0\",\n      elixir: \"~> 1.15\",\n      start_permanent: Mix.env() == :prod,\n      deps: deps(),\n      elixirc_paths: elixirc_paths(Mix.env())\n    ]\n  end\n\n  # Run \"mix help compile.app\" to learn about applications.\n  def application do\n    [\n      extra_applications: [:logger]\n    ]\n  end\n\n  # Run \"mix help deps\" to learn about dependencies.\n  defp deps do\n    [\n      {:httpoison, \"~> 2.1\"},\n      {:jason, \"~> 1.4\"}\n    ]\n  end\n\n  defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]\n  defp elixirc_paths(_), do: [\"lib\"]\nend\n\n",[331],{"type":40,"tag":60,"props":332,"children":333},{"__ignoreMap":6},[334,342,350,357,365,373,381,389,397,405,413,422,431,439,447,456,465,473,482,490,498,506,515,524,532,541,550,558,566,574,583,592],{"type":40,"tag":88,"props":335,"children":336},{"class":90,"line":91},[337],{"type":40,"tag":88,"props":338,"children":339},{},[340],{"type":54,"value":341},"defmodule LolesportsConsumer.MixProject do\n",{"type":40,"tag":88,"props":343,"children":344},{"class":90,"line":100},[345],{"type":40,"tag":88,"props":346,"children":347},{},[348],{"type":54,"value":349},"  use Mix.Project\n",{"type":40,"tag":88,"props":351,"children":352},{"class":90,"line":109},[353],{"type":40,"tag":88,"props":354,"children":355},{"emptyLinePlaceholder":183},[356],{"type":54,"value":186},{"type":40,"tag":88,"props":358,"children":359},{"class":90,"line":118},[360],{"type":40,"tag":88,"props":361,"children":362},{},[363],{"type":54,"value":364},"  def project do\n",{"type":40,"tag":88,"props":366,"children":367},{"class":90,"line":127},[368],{"type":40,"tag":88,"props":369,"children":370},{},[371],{"type":54,"value":372},"    [\n",{"type":40,"tag":88,"props":374,"children":375},{"class":90,"line":189},[376],{"type":40,"tag":88,"props":377,"children":378},{},[379],{"type":54,"value":380},"      app: :lolesports_consumer,\n",{"type":40,"tag":88,"props":382,"children":383},{"class":90,"line":198},[384],{"type":40,"tag":88,"props":385,"children":386},{},[387],{"type":54,"value":388},"      version: \"0.1.0\",\n",{"type":40,"tag":88,"props":390,"children":391},{"class":90,"line":206},[392],{"type":40,"tag":88,"props":393,"children":394},{},[395],{"type":54,"value":396},"      elixir: \"~> 1.15\",\n",{"type":40,"tag":88,"props":398,"children":399},{"class":90,"line":215},[400],{"type":40,"tag":88,"props":401,"children":402},{},[403],{"type":54,"value":404},"      start_permanent: Mix.env() == :prod,\n",{"type":40,"tag":88,"props":406,"children":407},{"class":90,"line":223},[408],{"type":40,"tag":88,"props":409,"children":410},{},[411],{"type":54,"value":412},"      deps: deps(),\n",{"type":40,"tag":88,"props":414,"children":416},{"class":90,"line":415},11,[417],{"type":40,"tag":88,"props":418,"children":419},{},[420],{"type":54,"value":421},"      elixirc_paths: elixirc_paths(Mix.env())\n",{"type":40,"tag":88,"props":423,"children":425},{"class":90,"line":424},12,[426],{"type":40,"tag":88,"props":427,"children":428},{},[429],{"type":54,"value":430},"    ]\n",{"type":40,"tag":88,"props":432,"children":434},{"class":90,"line":433},13,[435],{"type":40,"tag":88,"props":436,"children":437},{},[438],{"type":54,"value":124},{"type":40,"tag":88,"props":440,"children":442},{"class":90,"line":441},14,[443],{"type":40,"tag":88,"props":444,"children":445},{"emptyLinePlaceholder":183},[446],{"type":54,"value":186},{"type":40,"tag":88,"props":448,"children":450},{"class":90,"line":449},15,[451],{"type":40,"tag":88,"props":452,"children":453},{},[454],{"type":54,"value":455},"  # Run \"mix help compile.app\" to learn about applications.\n",{"type":40,"tag":88,"props":457,"children":459},{"class":90,"line":458},16,[460],{"type":40,"tag":88,"props":461,"children":462},{},[463],{"type":54,"value":464},"  def application do\n",{"type":40,"tag":88,"props":466,"children":468},{"class":90,"line":467},17,[469],{"type":40,"tag":88,"props":470,"children":471},{},[472],{"type":54,"value":372},{"type":40,"tag":88,"props":474,"children":476},{"class":90,"line":475},18,[477],{"type":40,"tag":88,"props":478,"children":479},{},[480],{"type":54,"value":481},"      extra_applications: [:logger]\n",{"type":40,"tag":88,"props":483,"children":485},{"class":90,"line":484},19,[486],{"type":40,"tag":88,"props":487,"children":488},{},[489],{"type":54,"value":430},{"type":40,"tag":88,"props":491,"children":493},{"class":90,"line":492},20,[494],{"type":40,"tag":88,"props":495,"children":496},{},[497],{"type":54,"value":124},{"type":40,"tag":88,"props":499,"children":501},{"class":90,"line":500},21,[502],{"type":40,"tag":88,"props":503,"children":504},{"emptyLinePlaceholder":183},[505],{"type":54,"value":186},{"type":40,"tag":88,"props":507,"children":509},{"class":90,"line":508},22,[510],{"type":40,"tag":88,"props":511,"children":512},{},[513],{"type":54,"value":514},"  # Run \"mix help deps\" to learn about dependencies.\n",{"type":40,"tag":88,"props":516,"children":518},{"class":90,"line":517},23,[519],{"type":40,"tag":88,"props":520,"children":521},{},[522],{"type":54,"value":523},"  defp deps do\n",{"type":40,"tag":88,"props":525,"children":527},{"class":90,"line":526},24,[528],{"type":40,"tag":88,"props":529,"children":530},{},[531],{"type":54,"value":372},{"type":40,"tag":88,"props":533,"children":535},{"class":90,"line":534},25,[536],{"type":40,"tag":88,"props":537,"children":538},{},[539],{"type":54,"value":540},"      {:httpoison, \"~> 2.1\"},\n",{"type":40,"tag":88,"props":542,"children":544},{"class":90,"line":543},26,[545],{"type":40,"tag":88,"props":546,"children":547},{},[548],{"type":54,"value":549},"      {:jason, \"~> 1.4\"}\n",{"type":40,"tag":88,"props":551,"children":553},{"class":90,"line":552},27,[554],{"type":40,"tag":88,"props":555,"children":556},{},[557],{"type":54,"value":430},{"type":40,"tag":88,"props":559,"children":561},{"class":90,"line":560},28,[562],{"type":40,"tag":88,"props":563,"children":564},{},[565],{"type":54,"value":124},{"type":40,"tag":88,"props":567,"children":569},{"class":90,"line":568},29,[570],{"type":40,"tag":88,"props":571,"children":572},{"emptyLinePlaceholder":183},[573],{"type":54,"value":186},{"type":40,"tag":88,"props":575,"children":577},{"class":90,"line":576},30,[578],{"type":40,"tag":88,"props":579,"children":580},{},[581],{"type":54,"value":582},"  defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]\n",{"type":40,"tag":88,"props":584,"children":586},{"class":90,"line":585},31,[587],{"type":40,"tag":88,"props":588,"children":589},{},[590],{"type":54,"value":591},"  defp elixirc_paths(_), do: [\"lib\"]\n",{"type":40,"tag":88,"props":593,"children":595},{"class":90,"line":594},32,[596],{"type":40,"tag":88,"props":597,"children":598},{},[599],{"type":54,"value":133},{"type":40,"tag":50,"props":601,"children":602},{},[603],{"type":54,"value":604},"The key differences were:",{"type":40,"tag":606,"props":607,"children":608},"ol",{},[609,629],{"type":40,"tag":610,"props":611,"children":612},"li",{},[613,615,621,623],{"type":54,"value":614},"Adding ",{"type":40,"tag":60,"props":616,"children":618},{"className":617},[],[619],{"type":54,"value":620},"elixirc_paths: elixirc_paths(Mix.env())",{"type":54,"value":622}," to ",{"type":40,"tag":60,"props":624,"children":626},{"className":625},[],[627],{"type":54,"value":628},"project",{"type":40,"tag":610,"props":630,"children":631},{},[632,634],{"type":54,"value":633},"Adding these two lines to the file:\n",{"type":40,"tag":635,"props":636,"children":637},"ul",{},[638,647],{"type":40,"tag":610,"props":639,"children":640},{},[641],{"type":40,"tag":60,"props":642,"children":644},{"className":643},[],[645],{"type":54,"value":646},"defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]",{"type":40,"tag":610,"props":648,"children":649},{},[650],{"type":40,"tag":60,"props":651,"children":653},{"className":652},[],[654],{"type":54,"value":655},"defp elixirc_paths(_), do: [\"lib\"]",{"type":40,"tag":67,"props":657,"children":659},{"id":658},"conclusion",[660],{"type":54,"value":661},"Conclusion",{"type":40,"tag":50,"props":663,"children":664},{},[665,667,673],{"type":54,"value":666},"With these configuration changes, I am able to properly call ",{"type":40,"tag":60,"props":668,"children":670},{"className":669},[],[671],{"type":54,"value":672},"LeagueInfoMocks.get_live()",{"type":54,"value":674}," and write tests against an expected HTTP response.",{"type":40,"tag":676,"props":677,"children":678},"style",{},[679],{"type":54,"value":680},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":6,"searchDepth":100,"depth":100,"links":682},[683,684,685],{"id":69,"depth":100,"text":72},{"id":251,"depth":100,"text":254},{"id":658,"depth":100,"text":661},"markdown","content:mocking-http-responses-in-elixir-and-phoenix.md","content","mocking-http-responses-in-elixir-and-phoenix.md","md",1730669434822]