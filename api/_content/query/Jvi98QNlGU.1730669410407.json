[{"_path":"/mocking-http-responses-in-elixir-and-phoenix","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Mocking HTTP Responses in Elixir and Phoenix","description":"A quick walkthrough of the configuration needed to support mocks and modules only used within your Elixir tests","type":"post","author":{"name":"Cody Bontecou","image":"/assets/img/cody.64b57256.jpg"},"date":"2023-08-13T00:00:00.000Z","last_modified_date":"2023-08-13T00:00:00.000Z","slug":"mocking-http-responses-in-elixir-and-phoenix","dropdown":"Elixir","meta":[{"name":"og:description","content":"A quick walkthrough of the configuration needed to support mocks and modules only used within your Elixir tests"},{"name":"og:image","content":"https://codybontecou.com/images/mocking-http-responses-in-elixir-and-phoenix.png"},{"name":"og:image:alt","content":"A quick walkthrough of the configuration needed to support mocks and modules only used within your Elixir tests"},{"name":"og:title","content":"Mocking HTTP Responses in Elixir and Phoenix"},{"name":"twitter:title","content":"Mocking HTTP Responses in Elixir and Phoenix"},{"name":"twitter:text:title","content":"Mocking HTTP Responses in Elixir and Phoenix"}],"canonicalUrl":"https://codybontecou.com/mocking-http-responses-in-elixir-and-phoenix.html","topics":["elixir","testing","mocking"],"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":""},"children":[{"type":"element","tag":"binding","props":{"value":"$frontmatter.title"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I just came across this error while attempting to mock the response of a 3rd party api:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"** (UndefinedFunctionError) function LeagueInfoMocks.get_live/0 is undefined (module LeagueInfoMocks is not available)"}]}]},{"type":"element","tag":"h2","props":{"id":"the-problem"},"children":[{"type":"text","value":"The Problem"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I couldn't wrap my head around it. I have this simple mock module defined:"}]},{"type":"element","tag":"pre","props":{"className":"language-elixir shiki shiki-themes github-light","code":"defmodule LeagueInfoMocks do\n  def get_live do\n    %{...}\n  end\nend\n\n","language":"elixir","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defmodule LeagueInfoMocks do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  def get_live do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    %{...}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"end\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And a test module to interact with the get_live function:"}]},{"type":"element","tag":"pre","props":{"className":"language-elixir shiki shiki-themes github-light","code":"defmodule LeagueInfoTest do\n  use ExUnit.Case\n  test \"format_info\" do\n    data = LeagueInfoMocks.get_live()\n\n    [match | _tail] = data\n\n    assert LeagueInfo.format_info(data) == %{...}\n  end\nend\n\n","language":"elixir","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defmodule LeagueInfoTest do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  use ExUnit.Case\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  test \"format_info\" do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    data = LeagueInfoMocks.get_live()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    [match | _tail] = data\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    assert LeagueInfo.format_info(data) == %{...}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"end\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"But running "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mix test"}]},{"type":"text","value":" would consistently give me the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"** (UndefinedFunctionError) function LeagueInfoMocks.get_live/0 is undefined (module LeagueInfoMocks is not available)"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"the-solution"},"children":[{"type":"text","value":"The Solution"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Most articles and threads mentioned moving the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"LeagueInfoMocks"}]},{"type":"text","value":" module in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"test/support/*"}]},{"type":"text","value":" directory, so I did. This didn't change the error message."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I eventually found "},{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/a/73967553/6642089","rel":["nofollow"]},"children":[{"type":"text","value":"this"}]},{"type":"text","value":" Stackoverflow comment that mentioned some configuration needed in the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mix.exs"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Supposedly, "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mix phx.new"}]},{"type":"text","value":" adds the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"test/support/*"}]},{"type":"text","value":" support when a Phoenix project is created. In my case, I'm building off of a simple Elixir application. This required me to configure my "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"mix.exs"}]},{"type":"text","value":" file to look like so:"}]},{"type":"element","tag":"pre","props":{"className":"language-elixir shiki shiki-themes github-light","code":"defmodule LolesportsConsumer.MixProject do\n  use Mix.Project\n\n  def project do\n    [\n      app: :lolesports_consumer,\n      version: \"0.1.0\",\n      elixir: \"~> 1.15\",\n      start_permanent: Mix.env() == :prod,\n      deps: deps(),\n      elixirc_paths: elixirc_paths(Mix.env())\n    ]\n  end\n\n  # Run \"mix help compile.app\" to learn about applications.\n  def application do\n    [\n      extra_applications: [:logger]\n    ]\n  end\n\n  # Run \"mix help deps\" to learn about dependencies.\n  defp deps do\n    [\n      {:httpoison, \"~> 2.1\"},\n      {:jason, \"~> 1.4\"}\n    ]\n  end\n\n  defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]\n  defp elixirc_paths(_), do: [\"lib\"]\nend\n\n","language":"elixir","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"defmodule LolesportsConsumer.MixProject do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  use Mix.Project\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  def project do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      app: :lolesports_consumer,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      version: \"0.1.0\",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      elixir: \"~> 1.15\",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      start_permanent: Mix.env() == :prod,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      deps: deps(),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      elixirc_paths: elixirc_paths(Mix.env())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    ]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  # Run \"mix help compile.app\" to learn about applications.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  def application do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      extra_applications: [:logger]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    ]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  # Run \"mix help deps\" to learn about dependencies.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  defp deps do\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      {:httpoison, \"~> 2.1\"},\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      {:jason, \"~> 1.4\"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    ]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  end\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  defp elixirc_paths(_), do: [\"lib\"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"end\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The key differences were:"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Adding "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"elixirc_paths: elixirc_paths(Mix.env())"}]},{"type":"text","value":" to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"project"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Adding these two lines to the file:\n"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defp elixirc_paths(:test), do: [\"lib\", \"test/support\"]"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"defp elixirc_paths(_), do: [\"lib\"]"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With these configuration changes, I am able to properly call "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"LeagueInfoMocks.get_live()"}]},{"type":"text","value":" and write tests against an expected HTTP response."}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-problem","depth":2,"text":"The Problem"},{"id":"the-solution","depth":2,"text":"The Solution"},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:mocking-http-responses-in-elixir-and-phoenix.md","_source":"content","_file":"mocking-http-responses-in-elixir-and-phoenix.md","_stem":"mocking-http-responses-in-elixir-and-phoenix","_extension":"md"},{"_path":"/mocking-api-with-msw-and-typescript","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Mocking an API request with Mock Service Worker and Typescript","description":"Use mswjs - Mock Service Worker - to mock an API request to Medium's API within a Typescript project.","type":"post","author":{"name":"Cody Bontecou","image":"https://codybontecou.com/images/cody-abstract.jpeg"},"date":"2020-07-25T00:00:00.000Z","category":"tutorials","dropdown":"NodeJS","tags":["mswjs","Code","Automated Testing","mswjs"],"meta":[{"name":"og:title","content":"Mocking an API request with Mock Service Worker and Typescript"},{"name":"og:description","content":"Use mswjs - Mock Service Worker - to mock an API request to Medium's API within a Typescript project."},{"name":"og:image","content":"https://codybontecou.com/images/MSW-Meta.png"},{"name":"og:image:alt","content":"Illustration of a man with a baret waving his hands with Reddit and Typescript logos above him"},{"name":"twitter:title","content":"Mocking an API request with Mock Service Worker and Typescript"},{"name":"twitter:text:title","content":"Mocking an API request with Mock Service Worker and Typescript"}],"canonicalUrl":"https://codybontecou.com/mocking-api-with-msw-and-typescript.html","topics":["mswjs","testing","mocking"],"body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"mocking-an-api-request-with-mock-service-worker-and-typescript"},"children":[{"type":"text","value":"Mocking an API request with Mock Service Worker and Typescript"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Testing software is essential to the development cycle of building applications. A strong test suite gives the developer(s) a sense of freedom to organize and refactor the codebase as needed without fear of unknowingly breaking something."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm using "},{"type":"element","tag":"a","props":{"href":"https://github.com/CodyBontecou/blogflow.io/","rel":["nofollow"]},"children":[{"type":"text","value":"Blogflow.io"}]},{"type":"text","value":" as a means to learn Typescript while simultaneously building a tool to help automate distributing blog posts throughout the web."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A large portion of this application requires integrating 3rd party APIs to communicate with services such as Medium, Hashnode, Reddit, etc."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It's tough to test against 3rd party APIs. We don't want to hit their endpoints every time we run our test suite. Instead, we choose to mock the response, making the assumption that given specific inputs, they API will output a specific response."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mswjs.io/","rel":["nofollow"]},"children":[{"type":"text","value":"Mock Service Worker (MSW)"}]},{"type":"text","value":" provides a simple way to intercept these API calls so that our tests aren't hitting 3rd party endpoints and interacting with live data."}]},{"type":"element","tag":"h2","props":{"id":"setup-and-installation"},"children":[{"type":"text","value":"Setup and Installation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I was going to walk you through setting MSW up but they provide such clear "},{"type":"element","tag":"a","props":{"href":"https://mswjs.io/docs/getting-started/install","rel":["nofollow"]},"children":[{"type":"text","value":"documentation"}]},{"type":"text","value":" that I think doing anything besides linking you to them would be an injustice."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You're welcome to view my "},{"type":"element","tag":"a","props":{"href":"https://github.com/CodyBontecou/blogflow.io","rel":["nofollow"]},"children":[{"type":"text","value":"repo"}]},{"type":"text","value":" if you would like to see how I set it up in my project alongside packages like dotenv and Typescript."}]},{"type":"element","tag":"h2","props":{"id":"mocking-mediums-api"},"children":[{"type":"text","value":"Mocking Medium's API"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Everything below assumes you followed the "},{"type":"element","tag":"a","props":{"href":"#installation"},"children":[{"type":"text","value":"Setup and Installation"}]},{"type":"text","value":" or have an understanding of MSW."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In order to mock Medium's Create a Post request, I checked their API "},{"type":"element","tag":"a","props":{"href":"https://github.com/Medium/medium-api-docs#32-publications","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"They provide an example response:"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-light","code":"HTTP/1.1 201 OK\nContent-Type: application/json; charset=utf-8\n\n{\n  \"data\": {\n    \"id\": \"e6f36a\",\n    \"title\": \"Liverpool FC\",\n    \"authorId\": \"5303d74c64f66366f00cb9b2a94f3251bf5\",\n    \"tags\": [\"football\", \"sport\", \"Liverpool\"],\n    \"url\": \"https://medium.com/@majelbstoat/liverpool-fc-e6f36a\",\n    \"canonicalUrl\": \"http://jamietalbot.com/posts/liverpool-fc\",\n    \"publishStatus\": \"public\",\n    \"publishedAt\": 1442286338435,\n    \"license\": \"all-rights-reserved\",\n    \"licenseUrl\": \"https://medium.com/policy/9db0094a1e0f\"\n  }\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"HTTP"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"1.1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":" 201"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":" OK\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"Content"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"Type"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": application"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"json; charset"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"utf"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"8\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"  \"data\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"id\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"e6f36a\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"title\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"Liverpool FC\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"authorId\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"5303d74c64f66366f00cb9b2a94f3251bf5\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"tags\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"football\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"sport\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"Liverpool\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"url\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"https://medium.com/@majelbstoat/liverpool-fc-e6f36a\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"canonicalUrl\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"http://jamietalbot.com/posts/liverpool-fc\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"publishStatus\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"public\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"publishedAt\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"1442286338435"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"license\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"all-rights-reserved\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"    \"licenseUrl\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"\"https://medium.com/policy/9db0094a1e0f\"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"  }\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Mocking this with MSW was simple. It was nearly a copy paste:"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-light","code":"//  src/mocks/handlers.ts\n\nimport { rest } from 'msw'\n\nexport const handlers = [\n1. rest.post('https://api.medium.com/*', (req, res, ctx) => {\n    return res(\n2.    ctx.status(201),\n3.    ctx.json({\n        data: {\n          id: 'e6f36a',\n          title: 'Liverpool FC',\n          authorId: '5303d74c64f66366f00cb9b2a94f3251bf5',\n          tags: ['football', 'sport', 'Liverpool'],\n          url: 'https://medium.com/@majelbstoat/liverpool-fc-e6f36a',\n          canonicalUrl: 'http://jamietalbot.com/posts/liverpool-fc',\n          publishStatus: 'public',\n          publishedAt: 1442286338435,\n          license: 'all-rights-reserved',\n          licenseUrl: 'https://medium.com/policy/9db0094a1e0f',\n        },\n      })\n    )\n  }),\n]\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"//  src/mocks/handlers.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" { rest } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":" 'msw'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":" handlers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" [\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"1."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" rest."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"post"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'https://api.medium.com/*'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", ("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209"},"children":[{"type":"text","value":"req"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209"},"children":[{"type":"text","value":"res"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#E36209"},"children":[{"type":"text","value":"ctx"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"    return"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":" res"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"2."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"    ctx."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"status"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"201"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"3."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"    ctx."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"json"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"        data: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          id: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'e6f36a'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          title: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'Liverpool FC'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          authorId: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'5303d74c64f66366f00cb9b2a94f3251bf5'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          tags: ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'football'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'sport'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'Liverpool'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          url: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'https://medium.com/@majelbstoat/liverpool-fc-e6f36a'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          canonicalUrl: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'http://jamietalbot.com/posts/liverpool-fc'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          publishStatus: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'public'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          publishedAt: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"1442286338435"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          license: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'all-rights-reserved'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"          licenseUrl: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'https://medium.com/policy/9db0094a1e0f'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"        },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"      })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"    )\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"  }),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"]\n"}]}]}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"I set this handler to intercept POST requests to any URL that starts with "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"https://api.medium.com/*"}]},{"type":"text","value":"."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"The "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"*"}]},{"type":"text","value":" represents a wildcard meaning anytime my application attempts to send a POST request to a URL starting with "},{"type":"element","tag":"a","props":{"href":"https://api.medium.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://api.medium.com/"}]},{"type":"text","value":", it will intercept it and return the provided response at 3."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"We are setting the HTTP response status code we'd like to test against."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"This is where we define the JSON response that we wish to be returned from the POST request."}]}]},{"type":"element","tag":"h2","props":{"id":"edge-cases"},"children":[{"type":"text","value":"Edge cases"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Certain packages require additional configuration. These are primarily "},{"type":"element","tag":"a","props":{"href":"https://jestjs.io/","rel":["nofollow"]},"children":[{"type":"text","value":"jest"}]},{"type":"text","value":" issues rather than MSW, but I ran into them while setting this up. I decided to document it incase anyone else runs into these issues like I did."}]},{"type":"element","tag":"h3","props":{"id":"dotenv"},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/motdotla/dotenv","rel":["nofollow"]},"children":[{"type":"text","value":"dotenv"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Within your "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"jest.config.ts"}]},{"type":"text","value":" file, make sure you have the following:"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-light","code":"// jest.config.ts\nmodule.exports = {\n  setupFiles: ['dotenv/config'],\n}\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// jest.config.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"  setupFiles: ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'dotenv/config'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"setuptests-file"},"children":[{"type":"text","value":"setupTests file"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You'll need to set up your jest tests to listen, reset, and close the MSW server."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you use Create React App, you may already have a file named "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"src/setupTests.js"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Otherwise, you'll need to create a setup file yourself."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then, add in the following code:"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-light","code":"// src/setupTests.js\nimport { server } from './mocks/server.js'\n\n// Establish API mocking before all tests.\nbeforeAll(() => server.listen())\n\n// Reset any request handlers that we may add during the tests,\n// so they don't affect other tests.\nafterEach(() => server.resetHandlers())\n\n// Clean up after the tests are finished.\nafterAll(() => server.close())\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// src/setupTests.js\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" { server } "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"from"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":" './mocks/server.js'\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// Establish API mocking before all tests.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"beforeAll"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"listen"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// Reset any request handlers that we may add during the tests,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// so they don't affect other tests.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"afterEach"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"resetHandlers"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"())\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// Clean up after the tests are finished.\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"afterAll"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"(() "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"=>"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" server."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"close"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"())\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This sets your Jest testing environment up to start the MSW server, reset it, and close it after different stages of the Jest lifecycle."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You'll then want to add a line to your "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"jest.config.ts"}]},{"type":"text","value":" file:"}]},{"type":"element","tag":"pre","props":{"className":"language-ts shiki shiki-themes github-light","code":"// jest.config.ts\nmodule.exports = {\n  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],\n}\n","language":"ts","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#6A737D"},"children":[{"type":"text","value":"// jest.config.ts\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"module"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":"exports"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"  setupFilesAfterEnv: ["}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'<rootDir>/src/setupTests.ts'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"error-enoent-no-such-file-or-directory-open-file"},"children":[{"type":"text","value":"Error: ENOENT: no such file or directory, open \"file\""}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I'm reading markdown files in Blogflow. Before writing my tests, I was using relative paths like so:"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-light","code":"const data = matter(readFile('./file.md'))\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":" data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":" matter"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":"'./file.md'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"))\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"My tests didn't like that and threw the error "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"Error: ENOENT: no such file or directory, open \"file\""}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/a/59179782/6642089","rel":["nofollow"]},"children":[{"type":"text","value":"This"}]},{"type":"text","value":" Stackoverflow post explained I needed to use "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"_dirname"}]},{"type":"text","value":". This code now looks like the snippet below. Now my tests and code run as expected."}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-light","code":"const data = matter(readFile(__dirname + '/file.md'))\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5"},"children":[{"type":"text","value":" data"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":" ="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":" matter"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"(__dirname "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62"},"children":[{"type":"text","value":" '/file.md'"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E"},"children":[{"type":"text","value":"))\n"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"conclusion"},"children":[{"type":"text","value":"Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is all fairly new to me, but I believe there is value in this sort of testing."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One immediate case is mocking response's that are loaded into components. It's tough to get every state through live data. It's much easier to mock certain HTTP status codes and response objects that will change the way a component is rendered."}]},{"type":"element","tag":"hr","props":{},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I hope this article was helpful. Let me know if you have any questions, comments, or suggestions on Twitter "},{"type":"element","tag":"a","props":{"href":"https://twitter.com/CodyBontecou","rel":["nofollow"]},"children":[{"type":"text","value":"@codybontecou"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"setup-and-installation","depth":2,"text":"Setup and Installation"},{"id":"mocking-mediums-api","depth":2,"text":"Mocking Medium's API"},{"id":"edge-cases","depth":2,"text":"Edge cases","children":[{"id":"dotenv","depth":3,"text":"dotenv"},{"id":"setuptests-file","depth":3,"text":"setupTests file"},{"id":"error-enoent-no-such-file-or-directory-open-file","depth":3,"text":"Error: ENOENT: no such file or directory, open \"file\""}]},{"id":"conclusion","depth":2,"text":"Conclusion"}]}},"_type":"markdown","_id":"content:mocking-api-with-msw-and-typescript.md","_source":"content","_file":"mocking-api-with-msw-and-typescript.md","_stem":"mocking-api-with-msw-and-typescript","_extension":"md"}]